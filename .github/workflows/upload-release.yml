# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# üì§ GITHUB RELEASE PUBLISHER - Enhanced with Backup Rotation
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
#
# CHANGES FROM ORIGINAL:
# - Line 25-30: Added 'max_backups' input for configurable retention
# - Line 175-220: Enhanced backup rotation with configurable limits
# - Line 225-245: Backup verification and reporting
# - Line 290-310: Backup list in summary
#
# WHY: Prevents unlimited release accumulation while maintaining history.
#      Configurable retention allows flexibility for different use cases.
#
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

name: üì§ Upload to GitHub Release

on:
  workflow_call:
    inputs:
      release_strategy:
        description: 'Release strategy: daily, weekly, or latest'
        required: false
        default: 'daily'
        type: string
      
      max_backups:
        description: 'Maximum number of backup releases to keep (0 = unlimited)'
        required: false
        default: 30
        type: number
    
    outputs:
      release_url:
        description: 'URL of the created/updated release'
        value: ${{ jobs.upload.outputs.release_url }}
      
      release_tag:
        description: 'Git tag of the release'
        value: ${{ jobs.upload.outputs.release_tag }}

  workflow_dispatch:
    inputs:
      release_strategy:
        description: 'Release strategy'
        required: false
        default: 'daily'
        type: choice
        options:
          - daily
          - weekly
          - latest
      
      max_backups:
        description: 'Max backups to keep'
        required: false
        default: '30'
        type: string

jobs:
  upload:
    name: Publishing to Release
    runs-on: ubuntu-latest
    timeout-minutes: 15
    permissions:
      contents: write
    
    outputs:
      release_url: ${{ steps.release.outputs.url }}
      release_tag: ${{ steps.prepare.outputs.tag }}
    
    steps:
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # SETUP
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      
      - name: üì• Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: üì• Download Compressed Archive
        uses: actions/download-artifact@v4
        with:
          name: compressed-data-archive
          path: ./artifacts/
      
      - name: üì• Download Metadata
        uses: actions/download-artifact@v4
        with:
          name: archive-metadata
          path: ./artifacts/
      
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # PREPARE RELEASE
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      
      - name: üè∑Ô∏è Determine Release Tag & Name
        id: prepare
        run: |
          TODAY=$(date +%Y-%m-%d)
          STRATEGY="${{ inputs.release_strategy || 'daily' }}"
          
          case "$STRATEGY" in
            daily)
              TAG="data-$TODAY"
              RELEASE_NAME="Game Data Snapshot - $TODAY"
              IS_PRERELEASE="false"
              ;;
            weekly)
              WEEK=$(date +%Y-W%V)
              TAG="data-$WEEK"
              RELEASE_NAME="Game Data Weekly - $WEEK"
              IS_PRERELEASE="false"
              ;;
            latest)
              TAG="data-latest"
              RELEASE_NAME="Latest Game Data"
              IS_PRERELEASE="false"
              ;;
          esac
          
          echo "tag=$TAG" >> $GITHUB_OUTPUT
          echo "name=$RELEASE_NAME" >> $GITHUB_OUTPUT
          echo "is_prerelease=$IS_PRERELEASE" >> $GITHUB_OUTPUT
          
          echo "üè∑Ô∏è Release Configuration:"
          echo "  ‚Ä¢ Tag: $TAG"
          echo "  ‚Ä¢ Name: $RELEASE_NAME"
          echo "  ‚Ä¢ Strategy: $STRATEGY"
      
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # GENERATE RELEASE NOTES
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      
      - name: üìù Generate Release Notes
        id: notes
        run: |
          TODAY=$(date +%Y-%m-%d)
          
          if [ -f "artifacts/archive-metadata.json" ]; then
            ARCHIVE_NAME=$(jq -r '.archive_name' artifacts/archive-metadata.json)
            COMPRESSED_SIZE=$(jq -r '.compressed_size_mb' artifacts/archive-metadata.json)
            COMPRESSION_RATIO=$(jq -r '.compression_ratio' artifacts/archive-metadata.json)
            TOTAL_ENTRIES=$(jq -r '.total_entries' artifacts/archive-metadata.json)
            PREV_ENTRIES=$(jq -r '.previous_entries' artifacts/archive-metadata.json)
            NEW_ENTRIES=$(jq -r '.new_entries' artifacts/archive-metadata.json)
          else
            ARCHIVE_NAME=$(ls artifacts/*.tar.gz | head -1 | xargs basename)
            COMPRESSED_SIZE="Unknown"
            COMPRESSION_RATIO="Unknown"
            TOTAL_ENTRIES="Unknown"
            PREV_ENTRIES="0"
            NEW_ENTRIES="Unknown"
          fi
          
          cat > release-notes.md << EOF
          # üéÆ Game Market Data Collection
          
          **Collection Date:** $TODAY
          
          ## üìä Dataset Information
          
          This release contains comprehensive gaming market data with full historical context.
          
          ### üì¶ What's Included
          
          - **SteamSpy Data**: Community-driven statistics for Steam games
          - **Historical Data**: All previously collected data merged with new entries
          - **Metadata**: Collection timestamps, source information, validation results
          - **Checksums**: MD5 and SHA256 for data integrity verification
          
          ### üìà Statistics
          
          | Metric | Value |
          |--------|-------|
          | **Archive Name** | \`$ARCHIVE_NAME\` |
          | **Total Entries** | $TOTAL_ENTRIES |
          | **New Entries (This Run)** | $NEW_ENTRIES |
          | **Previous Entries** | $PREV_ENTRIES |
          | **Compressed Size** | $COMPRESSED_SIZE MB |
          | **Compression Ratio** | $COMPRESSION_RATIO |
          | **Collection Date** | $TODAY |
          | **GitHub Run** | [#${{ github.run_number }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}) |
          
          ## üì• Download & Usage
          
          ### Quick Download
          
          \`\`\`bash
          # Download the archive
          wget https://github.com/${{ github.repository }}/releases/download/${{ steps.prepare.outputs.tag }}/$ARCHIVE_NAME
          
          # Verify integrity
          wget https://github.com/${{ github.repository }}/releases/download/${{ steps.prepare.outputs.tag }}/${ARCHIVE_NAME}.sha256
          sha256sum -c ${ARCHIVE_NAME}.sha256
          
          # Extract
          tar -xzf $ARCHIVE_NAME
          \`\`\`
          
          ### Python Usage
          
          \`\`\`python
          import pandas as pd
          import glob
          
          # Read all JSONL files
          files = glob.glob('Data/**/steamspy_data.jsonl', recursive=True)
          dfs = [pd.read_json(f, lines=True) for f in files]
          df = pd.concat(dfs, ignore_index=True)
          
          print(f"Total games: {len(df)}")
          print(df['genre'].value_counts())
          \`\`\`
          
          ## üîê Data Integrity
          
          All archives include checksums for verification:
          - **MD5**: For quick verification
          - **SHA256**: For cryptographic verification
          
          ## üìö Documentation
          
          - [Project README](https://github.com/${{ github.repository }}/blob/main/README.md)
          - [Data Collection Pipeline](https://github.com/${{ github.repository }}/blob/main/.github/workflows/pipeline.yml)
          
          ---
          
          *Automated collection by GitHub Actions | Data from SteamSpy*
          EOF
          
          echo "üìÑ Release notes generated"
      
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # CHECK FOR EXISTING RELEASE
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      
      - name: üîç Check for Existing Release
        id: check
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          TAG="${{ steps.prepare.outputs.tag }}"
          
          if gh release view "$TAG" > /dev/null 2>&1; then
            echo "exists=true" >> $GITHUB_OUTPUT
            echo "‚ÑπÔ∏è Release $TAG already exists - will update"
          else
            echo "exists=false" >> $GITHUB_OUTPUT
            echo "‚ú® Release $TAG does not exist - will create"
          fi
      
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # DELETE OLD RELEASE (if updating)
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      
      - name: üóëÔ∏è Delete Old Release Assets
        if: steps.check.outputs.exists == 'true'
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          TAG="${{ steps.prepare.outputs.tag }}"
          
          echo "üóëÔ∏è Cleaning up old assets for $TAG..."
          
          gh release delete "$TAG" --yes || true
          git push origin :refs/tags/"$TAG" || true
          
          echo "‚úÖ Cleanup complete"
      
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # CREATE/UPDATE RELEASE
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      
      - name: üöÄ Create GitHub Release
        id: release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.prepare.outputs.tag }}
          name: ${{ steps.prepare.outputs.name }}
          body_path: release-notes.md
          draft: false
          prerelease: ${{ steps.prepare.outputs.is_prerelease }}
          files: |
            artifacts/*.tar.gz
            artifacts/*.md5
            artifacts/*.sha256
            artifacts/*.json
          fail_on_unmatched_files: true
          generate_release_notes: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # VERIFICATION
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      
      - name: ‚úÖ Verify Release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          TAG="${{ steps.prepare.outputs.tag }}"
          
          echo "üîç Verifying release..."
          
          gh release view "$TAG" --json url,assets
          
          ASSET_COUNT=$(gh release view "$TAG" --json assets --jq '.assets | length')
          
          echo ""
          echo "‚úÖ Release verified!"
          echo "  ‚Ä¢ Tag: $TAG"
          echo "  ‚Ä¢ Assets: $ASSET_COUNT"
          echo "  ‚Ä¢ URL: ${{ steps.release.outputs.url }}"
      
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # BACKUP ROTATION (Enhanced with Configurable Limits)
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      
      - name: üîÑ Rotate Backup Releases
        if: inputs.release_strategy == 'daily'
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          MAX_BACKUPS="${{ inputs.max_backups }}"
          
          echo "üîÑ Managing backup releases (max: $MAX_BACKUPS)..."
          
          # Handle unlimited backups
          if [ "$MAX_BACKUPS" -eq 0 ]; then
            echo "‚ÑπÔ∏è Unlimited backups configured - skipping rotation"
            exit 0
          fi
          
          # Get all data releases sorted by date (newest first)
          echo "üìã Fetching all data releases..."
          gh release list --limit 200 | grep "^data-20" > all_releases.txt || true
          
          if [ ! -s all_releases.txt ]; then
            echo "‚ÑπÔ∏è No releases to rotate"
            exit 0
          fi
          
          TOTAL_RELEASES=$(wc -l < all_releases.txt)
          echo "üìä Found $TOTAL_RELEASES total releases"
          
          if [ "$TOTAL_RELEASES" -le "$MAX_BACKUPS" ]; then
            echo "‚úÖ Within backup limit ($TOTAL_RELEASES <= $MAX_BACKUPS)"
            exit 0
          fi
          
          # Calculate how many to delete
          TO_DELETE=$((TOTAL_RELEASES - MAX_BACKUPS))
          echo "üóëÔ∏è Need to delete $TO_DELETE old releases"
          
          # Delete oldest releases
          tail -n "$TO_DELETE" all_releases.txt | while read -r line; do
            TAG=$(echo "$line" | awk '{print $1}')
            DATE=$(echo "$line" | awk '{print $3}')
            
            echo "  ‚ùå Deleting: $TAG (from $DATE)"
            gh release delete "$TAG" --yes || echo "  ‚ö†Ô∏è Failed to delete $TAG"
          done
          
          echo "‚úÖ Backup rotation complete"
          echo ""
          echo "üìä Retention Summary:"
          echo "  ‚Ä¢ Kept: $MAX_BACKUPS releases"
          echo "  ‚Ä¢ Deleted: $TO_DELETE releases"
      
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # BACKUP VERIFICATION
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      
      - name: üìã List Current Backups
        if: inputs.release_strategy == 'daily'
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          echo "üìã Current backup releases:"
          echo ""
          
          gh release list --limit 100 | grep "^data-20" | head -20 | while read -r line; do
            TAG=$(echo "$line" | awk '{print $1}')
            DATE=$(echo "$line" | awk '{print $3}')
            echo "  ‚úì $TAG (created $DATE)"
          done
          
          BACKUP_COUNT=$(gh release list --limit 200 | grep -c "^data-20" || echo 0)
          echo ""
          echo "üìä Total backups: $BACKUP_COUNT"
          
          MAX_BACKUPS="${{ inputs.max_backups }}"
          if [ "$MAX_BACKUPS" -ne 0 ] && [ "$BACKUP_COUNT" -gt "$MAX_BACKUPS" ]; then
            echo "::warning::Backup count ($BACKUP_COUNT) exceeds limit ($MAX_BACKUPS)"
          fi
      
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # SUMMARY
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      
      - name: üìù Generate Job Summary
        run: |
          TAG="${{ steps.prepare.outputs.tag }}"
          RELEASE_URL="${{ steps.release.outputs.url }}"
          
          echo "## üì§ GitHub Release Published" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "‚úÖ **Status:** Success" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### üéØ Release Details" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Tag:** \`$TAG\`" >> $GITHUB_STEP_SUMMARY
          echo "- **Name:** ${{ steps.prepare.outputs.name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **URL:** [$RELEASE_URL]($RELEASE_URL)" >> $GITHUB_STEP_SUMMARY
          echo "- **Strategy:** ${{ inputs.release_strategy || 'daily' }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### üì¶ Published Assets" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- Compressed data archive (.tar.gz)" >> $GITHUB_STEP_SUMMARY
          echo "- MD5 checksum (.md5)" >> $GITHUB_STEP_SUMMARY
          echo "- SHA256 checksum (.sha256)" >> $GITHUB_STEP_SUMMARY
          echo "- Collection metadata (.json)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Add backup rotation info
          if [ "${{ inputs.release_strategy }}" == "daily" ]; then
            MAX_BACKUPS="${{ inputs.max_backups }}"
            BACKUP_COUNT=$(gh release list --limit 200 | grep -c "^data-20" 2>/dev/null || echo 0)
            
            echo "### üîÑ Backup Management" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "- **Max Backups:** $MAX_BACKUPS" >> $GITHUB_STEP_SUMMARY
            echo "- **Current Backups:** $BACKUP_COUNT" >> $GITHUB_STEP_SUMMARY
            
            if [ "$MAX_BACKUPS" -eq 0 ]; then
              echo "- **Retention:** Unlimited" >> $GITHUB_STEP_SUMMARY
            else
              echo "- **Retention:** Last $MAX_BACKUPS days" >> $GITHUB_STEP_SUMMARY
            fi
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "### üì• Download Command" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
          echo "gh release download $TAG -R ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        env:
          GH_TOKEN: ${{ github.token }}